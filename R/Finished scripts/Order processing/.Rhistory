# Chunk 1: Data.grab
# Select the file
rawtable<-as.data.frame(read_xlsx("C:\\Users\\Darren\\Desktop\\Weekly despatch - GENERAL.xlsx"))
#dropship<-as.data.frame(read_xlsx("\\\\10.103.128.1\\cpsldata\\CPS Master Docs\\CPS DAILY MASTER DOCS\\PO tracking\\DROP SHIP TRACK 22.xlsx"))%>%.[c(6,1,2,3,4,5,7,8)]
# Add new blank columns
rawtable['Tracking URL']=""
# Chunk 2: add.hardcode.values
PHtrackurl<-c("https://www.posthaste.co.nz/phl/servlet/ITNG_TAndTServlet?page=1&VCCA=Enabled&Key_Type=BarCode&barcode_data=")
rawtable['Tracking URL']=""
rawtable['Tracking URL']<-PHtrackurl
# Rearrange the table
rawexport<-rawtable[c(-8,-11)]
# Change the column headings to match desired output
colnames(rawexport)<-c('Customer Code','Invoice Number','Customer Order','Reference','Order Status','Invoice Date','Freight Carrier','Product Code','Description','Qty Shipped','Tracking Link (Paste in browser)')
colnames(prodtype)<-c('Product Code','Type')
#Add the tracking link column
rawexport['Tracking Link (Paste in browser)']=""
rawexport['Tracking Link (Paste in browser)']<-c(paste0(rawtable$`Tracking URL`,rawtable$`Consignment Number`))
rawexport<-rawexport%>%mutate(`Order Status` = str_replace(`Order Status`,"Entered","Part Shipped"))
# Chunk 3: Stockdespatches
despatches<-merge(rawexport,prodtype, by = 'Product Code')%>%.[c(2,3,4,5,6,7,1,9,10,8,11,12)]
despatches<-subset(despatches,despatches$'Freight Carrier' == "Post Haste")%>%filter(.,Type != "I" & `Qty Shipped` > 0)
# Chunk 4: Backorders
backorders<-read_xls("C:\\Users\\Darren\\Desktop\\pos.xls")%>%.[c(29,33,31,36,37,17,13)]%>%filter(.,`CUSTOMER CODE` %in% c("AIM001","BIW001","COR001","DRI001","EVT001","EXT001","GGB001","GIF001","GIL002","IML001","INV001","ONE003","PGG001","PLA002","SMA001","TLC001",is.na(`CUSTOMER CODE`)))
names(backorders)<-c("CUSTOMER","ORDER NO.","CUSTOMER ORDER NO.","PRODUCT","DESCRIPTION","QTY B/ORD","ETA")
# Chunk 5: Export
# Create .xlsx file
rundate<-today()
despatches %>% .[1:11] %>%
group_by(`Customer Code`) %>%
group_walk(~ write_xlsx(.x,paste0("\\\\10.103.128.1\\cpsldata\\CPS Master Docs\\CPS DAILY MASTER DOCS\\Weekly despatch report\\",.y$`Customer Code`," Weekly Despatch Report ",format(rundate, format="%d %m %Y"),".xlsx")))
backorders %>%
group_by(`CUSTOMER`) %>%
group_walk(~ write_xlsx(.x,paste0("\\\\10.103.128.1\\cpsldata\\CPS Master Docs\\CPS DAILY MASTER DOCS\\Weekly despatch report\\",.y$`CUSTOMER`," Weekly Backorder Report ",format(rundate, format="%d %m %Y"),".xlsx")))
# Chunk 6: Alldespatches
#despatches<-merge(rawexport,prodtype, by = 'Product Code')%>%.[c(2,3,4,5,6,7,1,9,10,8,11,12)]
#indents<-left_join(dropship,couriers, by = c("Freight Provider ID" = "Code"))%>%mutate(.,'Tracking Link' = paste(.$URL,.$`Tracking No.`))%>%.[-8]
#inddespatch<-seq_along(which(despatchall$Type == "I"))
#despatchall<-left_join(despatches,indents, by = c("Invoice Number" = "Sales Order"))
#for(i in inddespatch){replace(despatchall$`Tracking Link (Paste in browser)`[i],despatchall$`Tracking Link`)[i]}
viridian<-list.files("\\\\10.103.128.1\\PropellaEDI\\live\\Orders to import",pattern = "^\\w{7,10} CPS Orders",full.names=TRUE)%>%lapply(.,read_xlsx)#%>%do.call(rbind,.)
list.files("\\\\10.103.128.1\\PropellaEDI\\live\\Orders to import",pattern = "^\\w{7,10} CPS Orders",full.names=TRUE)
viridian<-list.files("\\\\10.103.128.1\\PropellaEDI\\live\\Orders to import",pattern = "^\\w{7,10} CPS Orders",full.names=TRUE)
viridian
str_detect(".csv",viridian)
list(viridian)
str_detect(".csv",list(viridian))
viridian1<-list.files("\\\\10.103.128.1\\PropellaEDI\\live\\Orders to import",pattern = "^\\w{7,10} CPS Orders.xlsx",full.names=TRUE)%>%lapply(.,read_xlsx)#%>%do.call(rbind,.)
viridian1
viridian1<-list.files("\\\\10.103.128.1\\PropellaEDI\\live\\Orders to import",pattern = "^\\w{7,10} CPS Orders.xlsx",full.names=TRUE)%>%lapply(.,read_xlsx)%>%reduce(.,full_join)#%>%do.call(rbind,.)
viridian1<-list.files("\\\\10.103.128.1\\PropellaEDI\\live\\Orders to import",pattern = "^\\w{7,10} CPS Orders.xlsx",full.names=TRUE)%>%lapply(.,fread)%>%reduce(.,full_join)#%>%do.call(rbind,.)
viridian1<-list.files("\\\\10.103.128.1\\PropellaEDI\\live\\Orders to import",pattern = "^\\w{7,10} CPS Orders.xlsx",full.names=TRUE)%>%lapply(.,fread)#%>%reduce(.,full_join)#%>%do.call(rbind,.)
rm(viridian1)
viridian1<-list.files("\\\\10.103.128.1\\PropellaEDI\\live\\Orders to import",pattern = "^\\w{7,10} CPS Orders.xlsx",full.names=TRUE)%>%lapply(.,fread)#%>%reduce(.,full_join)#%>%do.call(rbind,.)
viridian1
viridian1<-list.files("\\\\10.103.128.1\\PropellaEDI\\live\\Orders to import",pattern = "^\\w{7,10} CPS Orders.xlsx",full.names=TRUE)%>%lapply(.,fread())#%>%reduce(.,full_join)#%>%do.call(rbind,.)
viridian1<-list.files("\\\\10.103.128.1\\PropellaEDI\\live\\Orders to import",pattern = "^\\w{7,10} CPS Orders.xlsx",full.names=TRUE)%>%lapply(.,read_xlsx)#%>%reduce(.,full_join)#%>%do.call(rbind,.)
viridian1
seq_along(viridian1)
for(i in seq_along(viridian1)){viridian1[1]%>%select('Cart ID','Ref','Org title','Shipping Address','City','Post Code','Phone Number','Email','Product SKU','Product quantity')}
viridan1[1]
viridian1[1]
viridian1[1]%>%select('Cart ID','Ref','Org title','Shipping Address','City','Post Code','Phone Number','Email','Product SKU','Product quantity')
viridian1[1]%>%.[c('Cart ID','Ref','Org title','Shipping Address','City','Post Code','Phone Number','Email','Product SKU','Product quantity')]
viridian1[1]%>%select(any_of('Cart ID','Ref','Org title','Shipping Address','City','Post Code','Phone Number','Email','Product SKU','Product quantity'))
viridian1[1]%>%select(any_of(c('Cart ID','Ref','Org title','Shipping Address','City','Post Code','Phone Number','Email','Product SKU','Product quantity'))
)
viridian1[1]%>as.data.frame(.)%select(any_of('Cart ID','Ref','Org title','Shipping Address','City','Post Code','Phone Number','Email','Product SKU','Product quantity'))
as.data.frame(viridian1[1])%>%select(any_of('Cart ID','Ref','Org title','Shipping Address','City','Post Code','Phone Number','Email','Product SKU','Product quantity'))
as.data.frame.array(viridian1)
as.data.frame(viridian1[1])
as.data.frame(viridian1[1])%>%select(any_of('Cart ID','Ref','Org title','Shipping Address','City','Post Code','Phone Number','Email','Product SKU','Product quantity'))
as.data.frame(viridian1[1])%>%select(any_of(c('Cart ID','Ref','Org title','Shipping Address','City','Post Code','Phone Number','Email','Product SKU','Product quantity')))
names(as.data.frame(viridian1[1]))
as.data.frame(viridian1[1])%>%select(any_of(c(Cart.ID,Org.title,Shipping.Address,City,Post.Code,Phone.Number,Email,Product.SKU,Product.quantity)))
as.data.frame(viridian1[1])
as.data.frame(viridian1[1])%>%select(any_of(Cart.ID,Org.title,Shipping.Address,City,Post.Code,Phone.Number,Email,Product.SKU,Product.quantity))
as.data.frame(viridian1[1])%>%select(any_of(c(,Org.title,Shipping.Address,City,Post.Code,Phone.Number,Email,Product.SKU,Product.quantity)))
as.data.frame(viridian1[1])%>%select(Cart.ID,Org.title,Shipping.Address,City,Post.Code,Phone.Number,Email,Product.SKU,Product.quantity)
for(i in seq_along(viridian1)){viridian1[i]%>%select(Cart.ID,Org.title,Shipping.Address,City,Post.Code,Phone.Number,Email,Product.SKU,Product.quantity)
)
for(i in seq_along(viridian1)){viridian1[i]%>%select(Cart.ID,Org.title,Shipping.Address,City,Post.Code,Phone.Number,Email,Product.SKU,Product.quantity)}
lapply(viridian1,as.data.frame)
lapply(viridian1,as.data.frame)%>%select(Cart.ID,Org.title,Shipping.Address,City,Post.Code,Phone.Number,Email,Product.SKU,Product.quantity)
for(i in seq_along(viridian1)){viridian1[i]%>%select(Cart.ID,Org.title,Shipping.Address,City,Post.Code,Phone.Number,Email,Product.SKU,Product.quantity)%>%write_xlsx(.)
}
lapply(viridian1(as.data.frame))%>%reduce(.,full_join)
lapply(viridian1(as.data.frame))%>%do.call(reduce(.,full_join))
lapply(viridian1,as.data.frame)%>%reduce(.,full_join)
viridian1
# Libraries you need- run this every time you open RStudio
library(writexl)
library(readxl)
library(tidyverse)
library(lubridate)
library(filesstrings)
library(stringr)
library(data.table)
library(dplyr)
library(excel.link)
library(stringr.tools)
library(xlsx)
library(scales)
library(mgsub)
library(magick)
library(gsheet)
#Clear List of objects
rm(list = ls())
gc()
#Static object loads
prodtype<-read_xls("C:\\Users\\Darren\\Documents\\R Transfer\\Static lookups\\PRODTYPEALL.xls")
supplierrange<-read_xls("C:\\Users\\Darren\\Documents\\R Transfer\\Static lookups\\Supplier ranges.xls")
customerrange<-read_xls("C:\\Users\\Darren\\Documents\\R Transfer\\Static lookups\\Customer range.xls")
generalfreight<-read_xls("C:\\Users\\Darren\\Documents\\R Transfer\\Static lookups\\Freight master.xls")
boms<-read_xls("C:\\Users\\Darren\\Documents\\R Transfer\\Static lookups\\BOM.xls")
couriers<-read_xls("C:\\Users\\Darren\\Documents\\R Transfer\\Static lookups\\iSAMS Courier Codes.xls")
micostores<-gsheet2tbl("https://docs.google.com/spreadsheets/d/1lqrj2Bvs5yHZOWHaZt9cZ6rTcCEM1_JVOo_qLX_yeCc/edit#gid=0")
# Chunk 1: Datagrab
# Select the file
rawtable<-readxl::read_xlsx("\\\\10.103.128.1\\cpsldata\\CPS Master Docs\\CPS DAILY MASTER DOCS\\PO tracking\\INDENT PO tracking report.xlsx")
# Keep only the lines with no tracking
naonly<-subset(rawtable,is.na(Tracking))
col1<-today()
col2<-"Total Suppliers Chased"
col3<-length((unique(naonly$Supplier)))
# Chunk 2: Export
# Create files
naonly %>%
group_by(Supplier) %>%
group_walk(~ write_xlsx(.x,paste0("C:\\Users\\Darren\\Documents\\R transfer\\Integration Outputs\\Supplier Weekly PO Tracking\\",.y$Supplier,".xlsx")))
data.frame(col1,col2,col3)%>%fwrite(.,file = "C:\\Users\\Darren\\Documents\\R transfer\\Integration Outputs\\Supplier Weekly PO Tracking\\Weekly chase count.txt", sep= "|",col.names = FALSE, row.names = FALSE)
naonly
masterfile<-read_xlsx("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Bible.xlsx")
masterfile<-read_xlsx("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Bible\\shopifymasterfile.xlsx")
masterfile
masterfile<-read_xlsx("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Bible\\shopifymasterfile.xlsx")%>%.[c(2,8,19,5,9,10,11,12,1,6,21)]
masterfile<-read_xlsx("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Bible\\shopifymasterfile.xlsx")%>%.[c(2,8,19,5,9,10,11,12,1,6,21)]
masterfile
masterfile[12:24]=""
masterfile
masterfile[12:50]=""
masterfile<-read_xlsx("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Bible\\shopifymasterfile.xlsx")%>%.[c(2,8,19,5,9,10,11,12,1,6,21)]
masterfile[12:50]=""
masterfile<-masterfile[c(12,2,8,19,13,5,14,15,9,10,11,12,16,17,1,18:22,23,6,24:48,21,50)]
masterfile
colnames(masterfile)<-c("Handle",	"Title",	"Body (HTML)",	"Vendor",	"Standardized Product Type",	"Custom Product Type",	"Tags",	"Published",	"Option1 Name",	"Option1 Value",	"Option2 Name",	"Option2 Value",	"Option3 Name",	"Option3 Value",	"SKU",	"Grams",	"Inventory Tracker",	"Inventory Qty",	"Inventory Policy",	"Fulfillment Service",	"Price",	"Compare At Price",	"Requires Shipping",	"Taxable",	"Barcode",	"Image Src",	"Image Position",	"Image Alt Text",	"Gift Card",	"SEO Title",	"SEO Description",	"Google Shopping / Google Product Category",	"Google Shopping / Gender",	"Google Shopping / Age Group",	"Google Shopping / MPN",	"Google Shopping / AdWords Grouping",	"Google Shopping / AdWords Labels",	"Google Shopping / Condition",	"Google Shopping / Custom Product",	"Google Shopping / Custom Label 0",	"Google Shopping / Custom Label 1",	"Google Shopping / Custom Label 2",	"Google Shopping / Custom Label 3",	"Google Shopping / Custom Label 4",	"Image",	"Weight Unit",	"Tax Code",	"Cost per item",	"Status")
colnames(masterfile)<-c("Handle",	"Title",	"Body (HTML)",	"Vendor",	"Standardized Product Type",	"Custom Product Type",	"Tags",	"Published",	"Option1 Name",	"Option1 Value",	"Option2 Name",	"Option2 Value",	"Option3 Name",	"Option3 Value",	"SKU",	"Grams",	"Inventory Tracker",	"Inventory Qty",	"Inventory Policy",	"Fulfillment Service",	"Price",	"Compare At Price",	"Requires Shipping",	"Taxable",	"Barcode",	"Image Src",	"Image Position",	"Image Alt Text",	"Gift Card",	"SEO Title",	"SEO Description",	"Google Shopping / Google Product Category",	"Google Shopping / Gender",	"Google Shopping / Age Group",	"Google Shopping / MPN",	"Google Shopping / AdWords Grouping",	"Google Shopping / AdWords Labels",	"Google Shopping / Condition",	"Google Shopping / Custom Product",	"Google Shopping / Custom Label 0",	"Google Shopping / Custom Label 1",	"Google Shopping / Custom Label 2",	"Google Shopping / Custom Label 3",	"Google Shopping / Custom Label 4",	"Image",	"Weight Unit",	"Tax Code",	"Cost per item",	"Status")
masterfile['Tags']<-c(replicate(nrow(masterfile),"themarket"))
masterfile['Published']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Inventory Tracker']<-c(replicate(nrow(masterfile),"shopify"))
masterfile['Inventory Policy']<-c(replicate(nrow(masterfile),"deny"))
masterfile['Fulfillment Service']<-c(replicate(nrow(masterfile),"manual"))
masterfile['Requires Shipping']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Taxable']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Gift Card']<-c(replicate(nrow(masterfile),"FALSE"))
masterfile['Status']<-c(replicate(nrow(masterfile),"active"))
masterfile
filenamer<-paste("Shopify Import",Sys.Date())
pathnamer<-paste("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Uploads\\",filenamer,".csv")
filenamer
pathnamer
masterfile%>%write_csv(.,pathnamer)
gsub("-","_",ilenamer)
gsub("-","_",filenamer)
filenamer<-paste("Shopify Import",Sys.Date())
gsub("-","_",filenamer)
pathnamer<-paste("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Uploads\\",filenamer,".csv")
masterfile%>%write_csv(.,pathnamer)
filenamer<-paste("Shopify Import",Sys.Date())
gsub("-","_",filenamer)
pathnamer<-paste("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Uploads\\",filenamer,".csv")
filenamer
filenamer<-paste("Shopify Import",Sys.Date())%>%gsub("-","_",.)
pathnamer<-paste("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Uploads\\",filenamer,".csv")
filenamer
pathnemer
pathnamer
filenamer<-paste("Shopify Import",Sys.Date())%>%gsub("-","_",.)
pathnamer<-paste("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Uploads\\",filenamer,".csv")
masterfile%>%write_csv(.,pathnamer)
filenamer<-trimws(paste("Shopify Import",Sys.Date())%>%gsub("-","_",.))
filenamer<-trimws(paste("Shopify Import",Sys.Date())%>%gsub("-","_",.))
pathnamer<-paste("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Uploads\\",filenamer,".csv")
masterfile%>%write_csv(.,pathnamer)
pathnamer<-trimws(paste("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Uploads\\",filenamer,".csv"))
masterfile%>%write_csv(.,pathnamer)
filenamer<-paste("Shopify Import",Sys.Date())%>%gsub("-","_",.)
pathnamer<-paste("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Uploads\\",filenamer,".csv")
pathnamer
filenamer<-paste("Shopify Import",Sys.Date())%>%gsub("-","_",.)
pathnamer<-paste("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Uploads\\",trimws(filenamer),".csv")
pathnamer
filenamer
filenamer<-paste0("Shopify Import",Sys.Date())%>%gsub("-","_",.)
pathnamer<-paste0("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Uploads\\",filenamer,".csv")
pathnamer
masterfile%>%write_csv(.,pathnamer)
View(masterfile)
masterfile<-read_xlsx("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Bible\\shopifymasterfile.xlsx")%>%.[c(2,8,19,5,9,10,11,12,1,6,21)]
View(masterfile)
masterfile<-read_xlsx("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Bible\\shopifymasterfile.xlsx")%>%.[c(2,8,19,5,9,10,11,12,1,6,21)]
masterfile[12:50]=""
masterfile<-masterfile[c(12,1,2,3,13,4,14,15,9,10,11,12,16,17,9,5:8,23,10,24:48,1,50)]
colnames(masterfile)<-c("Handle",	"Title",	"Body (HTML)",	"Vendor",	"Standardized Product Type",	"Custom Product Type",	"Tags",	"Published",	"Option1 Name",	"Option1 Value",	"Option2 Name",	"Option2 Value",	"Option3 Name",	"Option3 Value",	"SKU",	"Grams",	"Inventory Tracker",	"Inventory Qty",	"Inventory Policy",	"Fulfillment Service",	"Price",	"Compare At Price",	"Requires Shipping",	"Taxable",	"Barcode",	"Image Src",	"Image Position",	"Image Alt Text",	"Gift Card",	"SEO Title",	"SEO Description",	"Google Shopping / Google Product Category",	"Google Shopping / Gender",	"Google Shopping / Age Group",	"Google Shopping / MPN",	"Google Shopping / AdWords Grouping",	"Google Shopping / AdWords Labels",	"Google Shopping / Condition",	"Google Shopping / Custom Product",	"Google Shopping / Custom Label 0",	"Google Shopping / Custom Label 1",	"Google Shopping / Custom Label 2",	"Google Shopping / Custom Label 3",	"Google Shopping / Custom Label 4",	"Image",	"Weight Unit",	"Tax Code",	"Cost per item",	"Status")
masterfile['Tags']<-c(replicate(nrow(masterfile),"themarket"))
masterfile['Published']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Inventory Tracker']<-c(replicate(nrow(masterfile),"shopify"))
masterfile['Inventory Policy']<-c(replicate(nrow(masterfile),"deny"))
masterfile['Fulfillment Service']<-c(replicate(nrow(masterfile),"manual"))
masterfile['Requires Shipping']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Taxable']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Gift Card']<-c(replicate(nrow(masterfile),"FALSE"))
masterfile['Status']<-c(replicate(nrow(masterfile),"active"))
masterfile%>%write_csv(.,pathnamer)
# Chunk 1: namers
filenamer<-paste0("Shopify Import",Sys.Date())%>%gsub("-","_",.)
pathnamer<-paste0("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Uploads\\",filenamer,".csv")
# Chunk 2: reader
masterfile<-read_xlsx("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Bible\\shopifymasterfile.xlsx")%>%.[c(2,8,19,5,9,10,11,12,1,6,21)]
masterfile[12:50]=""
masterfile<-masterfile[c(12,1,2,3,13,4,14,15,9,10,11,12,16,17,9,5:8,23,10,24:48,1,50)]
# Chunk 3: table.build
colnames(masterfile)<-c("Handle",	"Title",	"Body (HTML)",	"Vendor",	"Standardized Product Type",	"Custom Product Type",	"Tags",	"Published",	"Option1 Name",	"Option1 Value",	"Option2 Name",	"Option2 Value",	"Option3 Name",	"Option3 Value",	"SKU",	"Grams",	"Inventory Tracker",	"Inventory Qty",	"Inventory Policy",	"Fulfillment Service",	"Price",	"Compare At Price",	"Requires Shipping",	"Taxable",	"Barcode",	"Image Src",	"Image Position",	"Image Alt Text",	"Gift Card",	"SEO Title",	"SEO Description",	"Google Shopping / Google Product Category",	"Google Shopping / Gender",	"Google Shopping / Age Group",	"Google Shopping / MPN",	"Google Shopping / AdWords Grouping",	"Google Shopping / AdWords Labels",	"Google Shopping / Condition",	"Google Shopping / Custom Product",	"Google Shopping / Custom Label 0",	"Google Shopping / Custom Label 1",	"Google Shopping / Custom Label 2",	"Google Shopping / Custom Label 3",	"Google Shopping / Custom Label 4",	"Image",	"Weight Unit",	"Tax Code",	"Cost per item",	"Status")
masterfile['Tags']<-c(replicate(nrow(masterfile),"themarket"))
masterfile['Published']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Inventory Tracker']<-c(replicate(nrow(masterfile),"shopify"))
masterfile['Inventory Policy']<-c(replicate(nrow(masterfile),"deny"))
masterfile['Fulfillment Service']<-c(replicate(nrow(masterfile),"manual"))
masterfile['Requires Shipping']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Taxable']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Gift Card']<-c(replicate(nrow(masterfile),"FALSE"))
masterfile['Status']<-c(replicate(nrow(masterfile),"active"))
# Chunk 4: file.write
masterfile%>%write_csv(.,pathnamer)
# Chunk 1: Namers
# Set up some path name parameters
filenamer<-paste("Brolly PO",Sys.Date())
pathnamer<-paste("C:\\Users\\Darren\\Documents\\R transfer\\Integration Outputs\\Daily POs\\",filenamer,".xlsx")
# Chunk 2: Datagrab
# Get the data
brolly<-read.csv("C:\\Users\\Darren\\Desktop\\Daily POs BRO001.csv")
# Add new blank columns
brolly["Guest Last Name"]=""
brolly["Province"]=""
brolly["Telephone #"]=""
brolly["Catalogue Code"]=""
brolly['Customer.Group']<- c(gsub("^$","Loyalty", brolly$Customer.Group))
# Rearrange the table
import<-brolly[c(6,22,7,8,9,10,23,11,12,24,25,16,18,5,4,21,17,3)]
# Chunk 3: Renamecolumns
# Change the column headings to match Brolly format
colnames(import)<- c('Guest First Name','Guest Last Name','Address Line 1','Street Address','Suburb','City','Province','Country','PostCode','Telephone Number','Catalogue Code','Catalogue Description','Quantity','Order Date','Purchase Order','Sales Order #','Prod Code','Customer Code')
# Chunk 4: addhardcodevalues
# Hard code the country value, add last names to last name column, update first name column
import['Country']<-c(replicate(nrow(import),"New Zealand"))
lastnamevalues<-(str_extract(import$'Guest First Name',"\\w+$"))
import['Guest Last Name']<-lastnamevalues
firstnameonly<-gsub("\\s*\\w*$","", import$'Guest First Name')
import['Guest First Name']<-firstnameonly
import[5:6]<-apply(import[5:6],2, function (x) gsub("\\d{4}","",x))
# Chunk 5: Export
# Create the file
write_xlsx(import,pathnamer)
# Set up some path name parameters
filenamer<-paste("Brolly PO",Sys.Date())
pathnamer<-paste("C:\\Users\\Darren\\Documents\\R transfer\\Integration Outputs\\Daily POs\\",filenamer,".xlsx")
# Libraries you need- run this every time you open RStudio
library(writexl)
library(readxl)
library(tidyverse)
library(lubridate)
library(filesstrings)
library(stringr)
library(data.table)
library(dplyr)
library(excel.link)
library(stringr.tools)
library(xlsx)
library(scales)
library(mgsub)
library(magick)
library(gsheet)
#Clear List of objects
rm(list = ls())
gc()
#Static object loads
prodtype<-read_xls("C:\\Users\\Darren\\Documents\\R Transfer\\Static lookups\\PRODTYPEALL.xls")
supplierrange<-read_xls("C:\\Users\\Darren\\Documents\\R Transfer\\Static lookups\\Supplier ranges.xls")
customerrange<-read_xls("C:\\Users\\Darren\\Documents\\R Transfer\\Static lookups\\Customer range.xls")
generalfreight<-read_xls("C:\\Users\\Darren\\Documents\\R Transfer\\Static lookups\\Freight master.xls")
boms<-read_xls("C:\\Users\\Darren\\Documents\\R Transfer\\Static lookups\\BOM.xls")
couriers<-read_xls("C:\\Users\\Darren\\Documents\\R Transfer\\Static lookups\\iSAMS Courier Codes.xls")
micostores<-gsheet2tbl("https://docs.google.com/spreadsheets/d/1lqrj2Bvs5yHZOWHaZt9cZ6rTcCEM1_JVOo_qLX_yeCc/edit#gid=0")
filenamer<-paste0("Shopify Import",Sys.Date())%>%gsub("-","_",.)
pathnamer<-paste0("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Uploads\\",filenamer,".csv")
masterfile<-read_xlsx("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Bible\\shopifymasterfile.xlsx")%>%.[c(2,8,19,5,9,10,11,12,1,6,21)]
View(masterfile)
masterfile[12:50]=""
View(masterfile)
masterfile<-masterfile[c(12,1,2,3,13,4,14,15,5:8,16,17,9,5:8,16,17,9,18:22,10,23:48,11,50)]
colnames(masterfile)<-c("Handle",	"Title",	"Body (HTML)",	"Vendor",	"Standardized Product Type",	"Custom Product Type",	"Tags",	"Published",	"Option1 Name",	"Option1 Value",	"Option2 Name",	"Option2 Value",	"Option3 Name",	"Option3 Value",	"SKU",	"Grams",	"Inventory Tracker",	"Inventory Qty",	"Inventory Policy",	"Fulfillment Service",	"Price",	"Compare At Price",	"Requires Shipping",	"Taxable",	"Barcode",	"Image Src",	"Image Position",	"Image Alt Text",	"Gift Card",	"SEO Title",	"SEO Description",	"Google Shopping / Google Product Category",	"Google Shopping / Gender",	"Google Shopping / Age Group",	"Google Shopping / MPN",	"Google Shopping / AdWords Grouping",	"Google Shopping / AdWords Labels",	"Google Shopping / Condition",	"Google Shopping / Custom Product",	"Google Shopping / Custom Label 0",	"Google Shopping / Custom Label 1",	"Google Shopping / Custom Label 2",	"Google Shopping / Custom Label 3",	"Google Shopping / Custom Label 4",	"Image",	"Weight Unit",	"Tax Code",	"Cost per item",	"Status")
masterfile['Tags']<-c(replicate(nrow(masterfile),"themarket"))
masterfile['Published']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Inventory Tracker']<-c(replicate(nrow(masterfile),"shopify"))
masterfile['Inventory Policy']<-c(replicate(nrow(masterfile),"deny"))
masterfile['Fulfillment Service']<-c(replicate(nrow(masterfile),"manual"))
masterfile['Requires Shipping']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Taxable']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Gift Card']<-c(replicate(nrow(masterfile),"FALSE"))
masterfile['Status']<-c(replicate(nrow(masterfile),"active"))
masterfile%>%write_csv(.,pathnamer)
masterfile<-masterfile[c(12,1,2,3,13,4,14,15,5:8,16,17,9,18:22,10,23:48,11,50)]
masterfile<-read_xlsx("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Bible\\shopifymasterfile.xlsx")%>%.[c(2,8,19,5,9,10,11,12,1,6,21)]
masterfile[12:50]=""
masterfile<-masterfile[c(12,1,2,3,13,4,14,15,5:8,16,17,9,18:22,10,23:48,11,50)]
colnames(masterfile)<-c("Handle",	"Title",	"Body (HTML)",	"Vendor",	"Standardized Product Type",	"Custom Product Type",	"Tags",	"Published",	"Option1 Name",	"Option1 Value",	"Option2 Name",	"Option2 Value",	"Option3 Name",	"Option3 Value",	"SKU",	"Grams",	"Inventory Tracker",	"Inventory Qty",	"Inventory Policy",	"Fulfillment Service",	"Price",	"Compare At Price",	"Requires Shipping",	"Taxable",	"Barcode",	"Image Src",	"Image Position",	"Image Alt Text",	"Gift Card",	"SEO Title",	"SEO Description",	"Google Shopping / Google Product Category",	"Google Shopping / Gender",	"Google Shopping / Age Group",	"Google Shopping / MPN",	"Google Shopping / AdWords Grouping",	"Google Shopping / AdWords Labels",	"Google Shopping / Condition",	"Google Shopping / Custom Product",	"Google Shopping / Custom Label 0",	"Google Shopping / Custom Label 1",	"Google Shopping / Custom Label 2",	"Google Shopping / Custom Label 3",	"Google Shopping / Custom Label 4",	"Image",	"Weight Unit",	"Tax Code",	"Cost per item",	"Status")
masterfile['Tags']<-c(replicate(nrow(masterfile),"themarket"))
masterfile['Published']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Inventory Tracker']<-c(replicate(nrow(masterfile),"shopify"))
masterfile['Inventory Policy']<-c(replicate(nrow(masterfile),"deny"))
masterfile['Fulfillment Service']<-c(replicate(nrow(masterfile),"manual"))
masterfile['Requires Shipping']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Taxable']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Gift Card']<-c(replicate(nrow(masterfile),"FALSE"))
masterfile['Status']<-c(replicate(nrow(masterfile),"active"))
masterfile%>%write_csv(.,pathnamer)
# Chunk 1: namers
filenamer<-paste0("Shopify Import",Sys.Date())%>%gsub("-","_",.)
pathnamer<-paste0("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Uploads\\",filenamer,".csv")
# Chunk 2: reader
masterfile<-read_xlsx("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Bible\\shopifymasterfile.xlsx")%>%.[c(2,8,19,5,9,10,11,12,1,6,21)]
masterfile[12:50]=""
masterfile<-masterfile[c(12,1,2,3,13,4,14,15,5:8,16,17,9,18:22,10,23:48,11,50)]
# Chunk 3: table.build
colnames(masterfile)<-c("Handle",	"Title",	"Body (HTML)",	"Vendor",	"Standardized Product Type",	"Custom Product Type",	"Tags",	"Published",	"Option1 Name",	"Option1 Value",	"Option2 Name",	"Option2 Value",	"Option3 Name",	"Option3 Value",	"SKU",	"Grams",	"Inventory Tracker",	"Inventory Qty",	"Inventory Policy",	"Fulfillment Service",	"Price",	"Compare At Price",	"Requires Shipping",	"Taxable",	"Barcode",	"Image Src",	"Image Position",	"Image Alt Text",	"Gift Card",	"SEO Title",	"SEO Description",	"Google Shopping / Google Product Category",	"Google Shopping / Gender",	"Google Shopping / Age Group",	"Google Shopping / MPN",	"Google Shopping / AdWords Grouping",	"Google Shopping / AdWords Labels",	"Google Shopping / Condition",	"Google Shopping / Custom Product",	"Google Shopping / Custom Label 0",	"Google Shopping / Custom Label 1",	"Google Shopping / Custom Label 2",	"Google Shopping / Custom Label 3",	"Google Shopping / Custom Label 4",	"Image",	"Weight Unit",	"Tax Code",	"Cost per item",	"Status")
masterfile['Tags']<-c(replicate(nrow(masterfile),"themarket"))
masterfile['Published']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Inventory Tracker']<-c(replicate(nrow(masterfile),"shopify"))
masterfile['Inventory Policy']<-c(replicate(nrow(masterfile),"deny"))
masterfile['Fulfillment Service']<-c(replicate(nrow(masterfile),"manual"))
masterfile['Requires Shipping']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Taxable']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Gift Card']<-c(replicate(nrow(masterfile),"FALSE"))
masterfile['Status']<-c(replicate(nrow(masterfile),"active"))
# Chunk 4: file.write
masterfile%>%write_csv(.,pathnamer)
masterfile[SKU]
names(masterfile)
trimws(masterfile$SKU)
lapply((masterfile$SKU),gsub(" - ","-",.)
)
lapply((masterfile$SKU),gsub(" - ","-",masterfile$SKU)
)
lapply(masterfile$SKU,gsub(" - ","-",masterfile$SKU)
)
apply(masterfile$SKU){function(x) gsub(" - ","-",x)}
masterfile['Handle']<-apply(masterfile$SKU,2, function (x) gsub(" - ","-",x))
masterfile['Handle']<-c(apply(masterfile$SKU,2, function (x) gsub(" - ","-",x)))
apply(masterfile$SKU,2, function (x) gsub(" - ","-",x)))
apply(masterfile$SKU,2, function (x) gsub(" - ","-",x))
masterfile$SKU
masterfile['Handle']<-c(masterfile$SKU)
mastefile$handle
masterfile$Handle
masterfile['Handle']<-c(masterfile$SKU)%>%.<-c(apply(masterfile$SKU,2, function (x) gsub(" - ","-",x)))
masterfile['Handle']<-apply(masterfile$Handle,2, function (x) gsub(" - ","-",x))
masterfile['Handle']<-c(apply(masterfile$Handle,2, function (x) gsub(" - ","-",x)))
masterfile['Handle']<-c(masterfile$SKU)%>%gsub(" - ","-",.)
masterfile$Handle
# Chunk 1: namers
filenamer<-paste0("Shopify Import",Sys.Date())%>%gsub("-","_",.)
pathnamer<-paste0("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Uploads\\",filenamer,".csv")
# Chunk 2: reader
masterfile<-read_xlsx("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Bible\\shopifymasterfile.xlsx")%>%.[c(2,8,19,5,9,10,11,12,1,6,21)]
masterfile[12:50]=""
masterfile<-masterfile[c(12,1,2,3,13,4,14,15,5:8,16,17,9,18:22,10,23:48,11,50)]
# Chunk 3: table.build
colnames(masterfile)<-c("Handle",	"Title",	"Body (HTML)",	"Vendor",	"Standardized Product Type",	"Custom Product Type",	"Tags",	"Published",	"Option1 Name",	"Option1 Value",	"Option2 Name",	"Option2 Value",	"Option3 Name",	"Option3 Value",	"SKU",	"Grams",	"Inventory Tracker",	"Inventory Qty",	"Inventory Policy",	"Fulfillment Service",	"Price",	"Compare At Price",	"Requires Shipping",	"Taxable",	"Barcode",	"Image Src",	"Image Position",	"Image Alt Text",	"Gift Card",	"SEO Title",	"SEO Description",	"Google Shopping / Google Product Category",	"Google Shopping / Gender",	"Google Shopping / Age Group",	"Google Shopping / MPN",	"Google Shopping / AdWords Grouping",	"Google Shopping / AdWords Labels",	"Google Shopping / Condition",	"Google Shopping / Custom Product",	"Google Shopping / Custom Label 0",	"Google Shopping / Custom Label 1",	"Google Shopping / Custom Label 2",	"Google Shopping / Custom Label 3",	"Google Shopping / Custom Label 4",	"Image",	"Weight Unit",	"Tax Code",	"Cost per item",	"Status")
masterfile['Tags']<-c(replicate(nrow(masterfile),"themarket"))
masterfile['Published']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Inventory Tracker']<-c(replicate(nrow(masterfile),"shopify"))
masterfile['Inventory Policy']<-c(replicate(nrow(masterfile),"deny"))
masterfile['Fulfillment Service']<-c(replicate(nrow(masterfile),"manual"))
masterfile['Requires Shipping']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Taxable']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Gift Card']<-c(replicate(nrow(masterfile),"FALSE"))
masterfile['Status']<-c(replicate(nrow(masterfile),"active"))
masterfile['Handle']<-c(masterfile$SKU)%>%gsub(" - ","-",.)
# Chunk 4: file.write
masterfile%>%write_csv(.,pathnamer)
masterfile['Handle']<-c(masterfile$SKU)%>%gsub("  ","-",.,fixed  = TRUE)
masterfile$Handle
masterfile['Handle']<-c(masterfile$SKU)%>%mgsub(c(" - ","-"), c(" ",""),.,fixed  = TRUE)
masterfile['Handle']<-c(masterfile$SKU)%>%mgsub(.,c(" - ","-"), c(" ",""),fixed  = TRUE)
masterfile$Handle
rm(masterfile)
filenamer<-paste0("Shopify Import",Sys.Date())%>%gsub("-","_",.)
pathnamer<-paste0("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Uploads\\",filenamer,".csv")
masterfile<-read_xlsx("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Bible\\shopifymasterfile.xlsx")%>%.[c(2,8,19,5,9,10,11,12,1,6,21)]
masterfile[12:50]=""
masterfile<-masterfile[c(12,1,2,3,13,4,14,15,5:8,16,17,9,18:22,10,23:48,11,50)]
colnames(masterfile)<-c("Handle",	"Title",	"Body (HTML)",	"Vendor",	"Standardized Product Type",	"Custom Product Type",	"Tags",	"Published",	"Option1 Name",	"Option1 Value",	"Option2 Name",	"Option2 Value",	"Option3 Name",	"Option3 Value",	"SKU",	"Grams",	"Inventory Tracker",	"Inventory Qty",	"Inventory Policy",	"Fulfillment Service",	"Price",	"Compare At Price",	"Requires Shipping",	"Taxable",	"Barcode",	"Image Src",	"Image Position",	"Image Alt Text",	"Gift Card",	"SEO Title",	"SEO Description",	"Google Shopping / Google Product Category",	"Google Shopping / Gender",	"Google Shopping / Age Group",	"Google Shopping / MPN",	"Google Shopping / AdWords Grouping",	"Google Shopping / AdWords Labels",	"Google Shopping / Condition",	"Google Shopping / Custom Product",	"Google Shopping / Custom Label 0",	"Google Shopping / Custom Label 1",	"Google Shopping / Custom Label 2",	"Google Shopping / Custom Label 3",	"Google Shopping / Custom Label 4",	"Image",	"Weight Unit",	"Tax Code",	"Cost per item",	"Status")
masterfile['Tags']<-c(replicate(nrow(masterfile),"themarket"))
masterfile['Published']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Inventory Tracker']<-c(replicate(nrow(masterfile),"shopify"))
masterfile['Inventory Policy']<-c(replicate(nrow(masterfile),"deny"))
masterfile['Fulfillment Service']<-c(replicate(nrow(masterfile),"manual"))
masterfile['Requires Shipping']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Taxable']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Gift Card']<-c(replicate(nrow(masterfile),"FALSE"))
masterfile['Status']<-c(replicate(nrow(masterfile),"active"))
masterfile['Handle']<-c(masterfile$SKU)%>%mgsub(.,c(" - ","-"), c(" ",""),fixed  = TRUE)
masterfile$Handle
rm(masterfile)
filenamer<-paste0("Shopify Import",Sys.Date())%>%gsub("-","_",.)
pathnamer<-paste0("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Uploads\\",filenamer,".csv")
masterfile<-read_xlsx("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Bible\\shopifymasterfile.xlsx")%>%.[c(2,8,19,5,9,10,11,12,1,6,21)]
masterfile[12:50]=""
masterfile<-masterfile[c(12,1,2,3,13,4,14,15,5:8,16,17,9,18:22,10,23:48,11,50)]
colnames(masterfile)<-c("Handle",	"Title",	"Body (HTML)",	"Vendor",	"Standardized Product Type",	"Custom Product Type",	"Tags",	"Published",	"Option1 Name",	"Option1 Value",	"Option2 Name",	"Option2 Value",	"Option3 Name",	"Option3 Value",	"SKU",	"Grams",	"Inventory Tracker",	"Inventory Qty",	"Inventory Policy",	"Fulfillment Service",	"Price",	"Compare At Price",	"Requires Shipping",	"Taxable",	"Barcode",	"Image Src",	"Image Position",	"Image Alt Text",	"Gift Card",	"SEO Title",	"SEO Description",	"Google Shopping / Google Product Category",	"Google Shopping / Gender",	"Google Shopping / Age Group",	"Google Shopping / MPN",	"Google Shopping / AdWords Grouping",	"Google Shopping / AdWords Labels",	"Google Shopping / Condition",	"Google Shopping / Custom Product",	"Google Shopping / Custom Label 0",	"Google Shopping / Custom Label 1",	"Google Shopping / Custom Label 2",	"Google Shopping / Custom Label 3",	"Google Shopping / Custom Label 4",	"Image",	"Weight Unit",	"Tax Code",	"Cost per item",	"Status")
masterfile['Tags']<-c(replicate(nrow(masterfile),"themarket"))
masterfile['Published']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Inventory Tracker']<-c(replicate(nrow(masterfile),"shopify"))
masterfile['Inventory Policy']<-c(replicate(nrow(masterfile),"deny"))
masterfile['Fulfillment Service']<-c(replicate(nrow(masterfile),"manual"))
masterfile['Requires Shipping']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Taxable']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Gift Card']<-c(replicate(nrow(masterfile),"FALSE"))
masterfile['Status']<-c(replicate(nrow(masterfile),"active"))
masterfile['Handle']<-c(masterfile$SKU)
masterfile$hand;le
masterfile$Handle
masterfile['Handle']<-c(masterfile$SKU)%>%mgsub(.,c(" - ","-"), c(" ",""))
masterfile$Handle
masterfile['Handle']<-c(masterfile$SKU)%>%gsub("[[:space:]]", "", x)
masterfile['Handle']<-c(masterfile$SKU)%>%gsub("[[:space:]]", "", .)
rm(masterfile)
colnames(masterfile)<-c("Handle",	"Title",	"Body (HTML)",	"Vendor",	"Standardized Product Type",	"Custom Product Type",	"Tags",	"Published",	"Option1 Name",	"Option1 Value",	"Option2 Name",	"Option2 Value",	"Option3 Name",	"Option3 Value",	"SKU",	"Grams",	"Inventory Tracker",	"Inventory Qty",	"Inventory Policy",	"Fulfillment Service",	"Price",	"Compare At Price",	"Requires Shipping",	"Taxable",	"Barcode",	"Image Src",	"Image Position",	"Image Alt Text",	"Gift Card",	"SEO Title",	"SEO Description",	"Google Shopping / Google Product Category",	"Google Shopping / Gender",	"Google Shopping / Age Group",	"Google Shopping / MPN",	"Google Shopping / AdWords Grouping",	"Google Shopping / AdWords Labels",	"Google Shopping / Condition",	"Google Shopping / Custom Product",	"Google Shopping / Custom Label 0",	"Google Shopping / Custom Label 1",	"Google Shopping / Custom Label 2",	"Google Shopping / Custom Label 3",	"Google Shopping / Custom Label 4",	"Image",	"Weight Unit",	"Tax Code",	"Cost per item",	"Status")
filenamer<-paste0("Shopify Import",Sys.Date())%>%gsub("-","_",.)
pathnamer<-paste0("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Uploads\\",filenamer,".csv")
masterfile<-read_xlsx("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Bible\\shopifymasterfile.xlsx")%>%.[c(2,8,19,5,9,10,11,12,1,6,21)]
masterfile[12:50]=""
masterfile<-masterfile[c(12,1,2,3,13,4,14,15,5:8,16,17,9,18:22,10,23:48,11,50)]
colnames(masterfile)<-c("Handle",	"Title",	"Body (HTML)",	"Vendor",	"Standardized Product Type",	"Custom Product Type",	"Tags",	"Published",	"Option1 Name",	"Option1 Value",	"Option2 Name",	"Option2 Value",	"Option3 Name",	"Option3 Value",	"SKU",	"Grams",	"Inventory Tracker",	"Inventory Qty",	"Inventory Policy",	"Fulfillment Service",	"Price",	"Compare At Price",	"Requires Shipping",	"Taxable",	"Barcode",	"Image Src",	"Image Position",	"Image Alt Text",	"Gift Card",	"SEO Title",	"SEO Description",	"Google Shopping / Google Product Category",	"Google Shopping / Gender",	"Google Shopping / Age Group",	"Google Shopping / MPN",	"Google Shopping / AdWords Grouping",	"Google Shopping / AdWords Labels",	"Google Shopping / Condition",	"Google Shopping / Custom Product",	"Google Shopping / Custom Label 0",	"Google Shopping / Custom Label 1",	"Google Shopping / Custom Label 2",	"Google Shopping / Custom Label 3",	"Google Shopping / Custom Label 4",	"Image",	"Weight Unit",	"Tax Code",	"Cost per item",	"Status")
masterfile['Tags']<-c(replicate(nrow(masterfile),"themarket"))
masterfile['Published']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Inventory Tracker']<-c(replicate(nrow(masterfile),"shopify"))
masterfile['Inventory Policy']<-c(replicate(nrow(masterfile),"deny"))
masterfile['Fulfillment Service']<-c(replicate(nrow(masterfile),"manual"))
masterfile['Requires Shipping']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Taxable']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Gift Card']<-c(replicate(nrow(masterfile),"FALSE"))
masterfile['Status']<-c(replicate(nrow(masterfile),"active"))
masterfile['Handle']<-c(masterfile$SKU)%>%gsub("[[:space:]]", "", .)
masterfile$Handle
masterfile%>%write_csv(.,pathnamer)
masterfile['Option1 Name']<-c(masterfile$`Option1 Name`)%>%gsub("Colour","Color",.)
masterfile$`Option1 Name`
colnames(masterfile)<-c("Handle",	"Title",	"Body (HTML)",	"Vendor",	"Standardized Product Type",	"Custom Product Type",	"Tags",	"Published",	"Option1 Name",	"Option1 Value",	"Option2 Name",	"Option2 Value",	"Option3 Name",	"Option3 Value",	"SKU",	"Grams",	"Inventory Tracker",	"Inventory Qty",	"Inventory Policy",	"Fulfillment Service",	"Price",	"Compare At Price",	"Requires Shipping",	"Taxable",	"Barcode",	"Image Src",	"Image Position",	"Image Alt Text",	"Gift Card",	"SEO Title",	"SEO Description",	"Google Shopping / Google Product Category",	"Google Shopping / Gender",	"Google Shopping / Age Group",	"Google Shopping / MPN",	"Google Shopping / AdWords Grouping",	"Google Shopping / AdWords Labels",	"Google Shopping / Condition",	"Google Shopping / Custom Product",	"Google Shopping / Custom Label 0",	"Google Shopping / Custom Label 1",	"Google Shopping / Custom Label 2",	"Google Shopping / Custom Label 3",	"Google Shopping / Custom Label 4",	"Image",	"Weight Unit",	"Tax Code",	"Cost per item",	"Status")
masterfile['Tags']<-c(replicate(nrow(masterfile),"themarket"))
masterfile['Published']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Inventory Tracker']<-c(replicate(nrow(masterfile),"shopify"))
masterfile['Inventory Policy']<-c(replicate(nrow(masterfile),"deny"))
masterfile['Fulfillment Service']<-c(replicate(nrow(masterfile),"manual"))
masterfile['Requires Shipping']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Taxable']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Gift Card']<-c(replicate(nrow(masterfile),"FALSE"))
masterfile['Status']<-c(replicate(nrow(masterfile),"active"))
masterfile['Handle']<-c(masterfile$SKU)%>%gsub("[[:space:]]", "", .)
masterfile['Option1 Name']<-c(masterfile$`Option1 Name`)%>%gsub("Colour","Color",.)
masterfile%>%write_csv(.,pathnamer)
filenamer<-paste0("Shopify_Import_Master",Sys.Date())%>%gsub("-","_",.)
pathnamer<-paste0("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Bible\\",filenamer,".csv")
masterfile<-read_xlsx("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Bible\\shopifymasterfile.xlsx")%>%.[c(2,8,19,5,9,10,11,12,1,6,21)]
filenamer<-paste0("Shopify_Import_Master",Sys.Date())%>%gsub("-","_",.)
pathnamer<-paste0("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Bible\\",filenamer,".csv")
masterfile<-read_xlsx("C:\\Users\\Darren\\OneDrive\\CPS\\Shopify 2022\\Bible\\shopifymasterfile.xlsx")%>%.[c(2,8,19,5,9,10,11,12,1,6,21)]
masterfile[12:50]=""
masterfile<-masterfile[c(12,1,2,3,13,4,14,15,5:8,16,17,9,18:22,10,23:48,11,50)]
colnames(masterfile)<-c("Handle",	"Title",	"Body (HTML)",	"Vendor",	"Standardized Product Type",	"Custom Product Type",	"Tags",	"Published",	"Option1 Name",	"Option1 Value",	"Option2 Name",	"Option2 Value",	"Option3 Name",	"Option3 Value",	"SKU",	"Grams",	"Inventory Tracker",	"Inventory Qty",	"Inventory Policy",	"Fulfillment Service",	"Price",	"Compare At Price",	"Requires Shipping",	"Taxable",	"Barcode",	"Image Src",	"Image Position",	"Image Alt Text",	"Gift Card",	"SEO Title",	"SEO Description",	"Google Shopping / Google Product Category",	"Google Shopping / Gender",	"Google Shopping / Age Group",	"Google Shopping / MPN",	"Google Shopping / AdWords Grouping",	"Google Shopping / AdWords Labels",	"Google Shopping / Condition",	"Google Shopping / Custom Product",	"Google Shopping / Custom Label 0",	"Google Shopping / Custom Label 1",	"Google Shopping / Custom Label 2",	"Google Shopping / Custom Label 3",	"Google Shopping / Custom Label 4",	"Image",	"Weight Unit",	"Tax Code",	"Cost per item",	"Status")
masterfile['Tags']<-c(replicate(nrow(masterfile),"themarket"))
masterfile['Published']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Inventory Tracker']<-c(replicate(nrow(masterfile),"shopify"))
masterfile['Inventory Policy']<-c(replicate(nrow(masterfile),"deny"))
masterfile['Fulfillment Service']<-c(replicate(nrow(masterfile),"manual"))
masterfile['Requires Shipping']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Taxable']<-c(replicate(nrow(masterfile),"TRUE"))
masterfile['Gift Card']<-c(replicate(nrow(masterfile),"FALSE"))
masterfile['Status']<-c(replicate(nrow(masterfile),"active"))
masterfile['Handle']<-c(masterfile$SKU)%>%gsub("[[:space:]]", "", .)
masterfile['Option1 Name']<-c(masterfile$`Option1 Name`)%>%gsub("Colour","Color",.)
masterfile%>%write_csv(.,pathnamer)
imagelist<-list.files(choose.dir(), pattern="\\.", full.names = TRUE, recursive = FALSE)
for (i in seq_along(imagelist)){imagelist[i] %>% image_read() %>% image_flatten() %>% image_write(.,imagelist[i])}
realimages<-lapply(imagelist,image_read)
dimslist<-lapply(realimages,image_info)
dimarray<-array(dimslist)
names(dimarray)<-c(imagelist)
dimstibble<-dimarray%>%lapply(.,head,1)%>%do.call(rbind,.)%>%mutate(.,'Megapixels' = (.$width*.$height)/1000000,'filename' = c(names(dimarray)))%>%relocate(.,'filename', .before = 'format')
checksum<-nrow(dimstibble)-nrow(dimslist)
print(checksum)
exceptions<-subset(dimstibble, Megapixels >= 20)%>%mutate('maxparam' = pmax(.$width, .$height),'factor' = 2048/maxparam, 'new height' = height*factor, 'new width' = width*factor, 'resizeval' = percent(round(1-factor,2)))
message(paste(length(exceptions$filename),"images to resize."))
gc()
for (i in seq_along(exceptions$filename)){exceptions$filename[i] %>% image_read() %>% image_resize(.,exceptions$resizeval[i]) %>% image_write(.,exceptions$filename[i])}
rm(i)
gc()
szexceptions<-subset(dimstibble, filesize >=20000000)%>%mutate('factor' = 19/(.$filesize/1000000), 'resizeval' = percent(round(1-factor,2)))
print(szexceptions)
for (i in seq_along(szexceptions$filename)){szexceptions$filename[i] %>% image_read() %>% image_scale(.,szexceptions$resizeval[i]) %>% image_write(.,szexceptions$filename[i])}
rm(i)
gc()
